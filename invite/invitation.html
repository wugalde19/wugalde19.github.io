<!-- 
    IMPORTANT: For the ornamental borders to work, you need to upload the following images:
    - images/corner-top-left.png - Top left corner decoration
    - images/corner-top-right.png - Top right corner decoration
    - images/corner-bottom-left.png - Bottom left corner decoration
    - images/corner-bottom-right.png - Bottom right corner decoration
    - images/border-top.png - Top horizontal border
    - images/border-bottom.png - Bottom horizontal border
    
    These should be ornamental gold/bronze elements similar to those in the provided examples.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danny & Sofía - Wedding Invitation</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="header-content">
            <div class="initials">
                <span>D</span> <span>S</span>
            </div>
            <h1 id="couple-names">Danny & Sofía</h1>
            <p class="quote">"Todos somos mortales, hasta el primer beso y la segunda copa de vino"</p>
        </div>
    </header>

    <!-- Countdown Section -->
    <section id="countdown">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Falta</h2>
            <div class="countdown-timer">
                <div class="countdown-item" id="months-container">
                    <span id="months">00</span>
                    <p>meses</p>
                </div>
                <div class="countdown-item">
                    <span id="days">00</span>
                    <p>días</p>
                </div>
                <div class="countdown-item">
                    <span id="hours">00</span>
                    <p>hs</p>
                </div>
                <div class="countdown-item">
                    <span id="minutes">00</span>
                    <p>min</p>
                </div>
                <div class="countdown-item">
                    <span id="seconds">00</span>
                    <p>seg</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Ceremony Section -->
    <section id="ceremony">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Ceremonia</h2>
            <div class="event-details">
                <div class="detail-item">
                    <h3>Día</h3>
                    <p>Sábado 15 de Mayo - 17hs</p>
                    <button class="btn btn-small" onclick="addToCalendar('ceremony')">Agendar</button>
                </div>
                <div class="detail-item">
                    <h3>Lugar</h3>
                    <p>Parroquia Nuestra Señora de Lujan</p>
                    <button class="btn btn-primary" onclick="openModal('ceremonyConfirm')">Confirmar asistencia</button>
                </div>
                <div class="detail-item">
                    <h3>Dirección</h3>
                    <p>Av. Pergamino 203 - San José</p>
                    <div class="map-buttons">
                        <a href="#" class="btn btn-small" onclick="openDirections('Parroquia Nuestra Señora de Lujan, Av. Pergamino 203, San José', 'google')"><i class="fab fa-google"></i> Google Maps</a>
                        <a href="#" class="btn btn-small" onclick="openDirections('Parroquia Nuestra Señora de Lujan, Av. Pergamino 203, San José', 'waze')"><i class="fab fa-waze"></i> Waze</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Celebration Section -->
    <section id="celebration">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Celebración</h2>
            <div class="event-details">
                <div class="detail-item">
                    <h3>Día</h3>
                    <p>Sábado 15 de Mayo - 20hs</p>
                    <button class="btn btn-small" onclick="addToCalendar('celebration')">Agendar</button>
                </div>
                <div class="detail-item">
                    <h3>Lugar</h3>
                    <p>Salon de fiestas Avril</p>
                    <button class="btn btn-primary" onclick="openModal('celebrationConfirm')">Confirmar asistencia</button>
                </div>
                <div class="detail-item">
                    <h3>Dirección</h3>
                    <p>Av. Los Reartes 12 - San José</p>
                    <div class="map-buttons">
                        <a href="#" class="btn btn-small" onclick="openDirections('Salon de fiestas Avril, Av. Los Reartes 12, San José', 'google')"><i class="fab fa-google"></i> Google Maps</a>
                        <a href="#" class="btn btn-small" onclick="openDirections('Salon de fiestas Avril, Av. Los Reartes 12, San José', 'waze')"><i class="fab fa-waze"></i> Waze</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Retratos de Nuestro Amor</h2>
            <p>Un minuto, un segundo, un instante que queda en la eternidad</p>
            <div class="gallery-container">
                <!-- Images will be loaded dynamically -->
                <div class="gallery-item" style="background-image: url('images/couple1.jpg');"></div>
                <div class="gallery-item" style="background-image: url('images/couple2.jpg');"></div>
                <div class="gallery-item" style="background-image: url('images/couple3.jpg');"></div>
                <div class="gallery-item" style="background-image: url('images/couple4.jpg');"></div>
            </div>
        </div>
    </section>

    <!-- Party Section -->
    <section id="party">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Fiesta</h2>
            <p>Hagamos juntos una fiesta épica. Aquí algunos detalles a tener en cuenta.</p>
            
            <div class="party-details">
                <div class="party-item">
                    <i class="fas fa-music party-icon"></i>
                    <h3>Música</h3>
                    <p>¿Cuál es la canción que no debe faltar en la PlayList de la fiesta?</p>
                    <button class="btn btn-secondary" onclick="openModal('musicSuggestion')">Sugerir canción</button>
                </div>
                
                <div class="party-item">
                    <i class="fas fa-tshirt party-icon"></i>
                    <h3>Dress Code</h3>
                    <p>Una orientación para tu vestuario</p>
                    <button class="btn btn-secondary" onclick="openModal('dressCode')">Ver más</button>
                </div>
                
                <div class="party-item">
                    <i class="fas fa-info-circle party-icon"></i>
                    <h3>Tips y Notas</h3>
                    <p>Información adicional para tener en cuenta</p>
                    <button class="btn btn-secondary" onclick="openModal('tips')">+ Info</button>
                </div>
                
                <div class="party-item">
                    <i class="fas fa-utensils party-icon"></i>
                    <h3>Menú</h3>
                    <p>Conoce las opciones gastronómicas de la celebración</p>
                    <button class="btn btn-secondary" onclick="openModal('menu')">Ver menú</button>
                </div>
                
                <div class="party-item">
                    <i class="fas fa-champagne-glasses party-icon"></i>
                    <h3>Brindis</h3>
                    <p>No te pierdas el brindis especial a las 23:00hs</p>
                </div>
                
                <div class="party-item">
                    <i class="fas fa-child party-icon"></i>
                    <h3>Área para niños</h3>
                    <p>Contamos con espacio y actividades para los más pequeños</p>
                    <button class="btn btn-secondary" onclick="openModal('kidsArea')">Más detalles</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Gifts Section -->
    <section id="gifts">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Regalos</h2>
            <p>Si deseas regalarnos algo más que tu hermosa presencia...</p>
            <button class="btn btn-primary" onclick="openModal('giftsModal')">Ver más</button>
        </div>
    </section>

    <!-- Social Media Section -->
    <section id="social">
        <div class="section-container">
            <div class="ornamental-corner corner-top-left"></div>
            <div class="ornamental-corner corner-top-right"></div>
            <div class="ornamental-corner corner-bottom-left"></div>
            <div class="ornamental-corner corner-bottom-right"></div>
            <h2>Compartí este día con nosotros</h2>
            <p>Compartí tus fotos y videos de este hermoso día</p>
            <div class="social-options">
                <div class="social-option">
                    <h3>Instagram</h3>
                    <div class="hashtag">#dannyysofia</div>
                    <button class="btn btn-secondary" onclick="window.open('https://www.instagram.com/explore/tags/dannyysofia/', '_blank')">Ver en Instagram</button>
                </div>
                <div class="social-option">
                    <h3>Google Photos</h3>
                    <p>Escanea el código QR para subir fotos directamente a nuestro álbum</p>
                    <div class="qr-container">
                        <img src="images/google-photos-qr.png" alt="Google Photos QR" class="qr-code">
                    </div>
                    <button class="btn btn-secondary" onclick="openModal('photoUpload')">Instrucciones</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="initials">
                <span>D</span> <span>S</span>
            </div>
            <h2>Danny & Sofía</h2>
            <ul class="footer-links">
                <li><a href="#" onclick="openModal('ceremonyConfirm')">Confirmar asistencia a ceremonia</a></li>
                <li><a href="#" onclick="openModal('celebrationConfirm')">Confirmar asistencia a celebración</a></li>
                <li><a href="#" onclick="openModal('musicSuggestion')">Sugerir canción</a></li>
                <li><a href="#" onclick="addToCalendar('celebration')">Agendar Celebración</a></li>
                <li><a href="#" onclick="addToCalendar('ceremony')">Agendar Ceremonia</a></li>
            </ul>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Ceremony Confirmation Modal -->
    <div id="ceremonyConfirm" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('ceremonyConfirm')">&times;</span>
            <h3>Confirmar Asistencia a Ceremonia</h3>
            <form id="ceremonyConfirmForm">
                <input type="hidden" id="ceremonyInviteeId" name="inviteeId">
                <input type="hidden" id="ceremonyEventType" name="eventType" value="ceremony">
                
                <div class="form-group">
                    <p>Confirmas tu asistencia para <span id="ceremonyGuestCount">0</span> personas?</p>
                    <div class="attendance-selector">
                        <button type="button" class="btn btn-primary" onclick="confirmAttendance('ceremony', true)">¡Sí, confirmo!</button>
                        <button type="button" class="btn btn-secondary" onclick="confirmAttendance('ceremony', false)">No puedo :(</button>
                    </div>
                </div>
                
                <div id="ceremonyGuestDetails" class="form-group" style="display: none;">
                    <label for="ceremonyAttendingCount">¿Cuántas personas asistirán?</label>
                    <select id="ceremonyAttendingCount" name="attendingCount">
                        <!-- Options will be populated dynamically based on max guests -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ceremonyComment">Mensaje o buenos deseos</label>
                    <textarea id="ceremonyComment" name="comment" rows="3"></textarea>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="submitConfirmation('ceremony')">Enviar</button>
            </form>
        </div>
    </div>

    <!-- Celebration Confirmation Modal -->
    <div id="celebrationConfirm" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('celebrationConfirm')">&times;</span>
            <h3>Confirmar Asistencia a Celebración</h3>
            <form id="celebrationConfirmForm">
                <input type="hidden" id="celebrationInviteeId" name="inviteeId">
                <input type="hidden" id="celebrationEventType" name="eventType" value="celebration">
                
                <div class="form-group">
                    <p>Confirmas tu asistencia para <span id="celebrationGuestCount">0</span> personas?</p>
                    <div class="attendance-selector">
                        <button type="button" class="btn btn-primary" onclick="confirmAttendance('celebration', true)">¡Sí, confirmo!</button>
                        <button type="button" class="btn btn-secondary" onclick="confirmAttendance('celebration', false)">No puedo :(</button>
                    </div>
                </div>
                
                <div id="celebrationGuestDetails" class="form-group" style="display: none;">
                    <label for="celebrationAttendingCount">¿Cuántas personas asistirán?</label>
                    <select id="celebrationAttendingCount" name="attendingCount">
                        <!-- Options will be populated dynamically based on max guests -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="celebrationComment">Mensaje o buenos deseos</label>
                    <textarea id="celebrationComment" name="comment" rows="3"></textarea>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="submitConfirmation('celebration')">Enviar</button>
            </form>
        </div>
    </div>

    <!-- Music Suggestion Modal -->
    <div id="musicSuggestion" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('musicSuggestion')">&times;</span>
            <h3>Sugerir Canción</h3>
            <form id="musicSuggestionForm">
                <input type="hidden" id="musicInviteeId" name="inviteeId">
                
                <div class="form-group">
                    <label for="songTitle">Título de la canción</label>
                    <input type="text" id="songTitle" name="songTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="artist">Artista</label>
                    <input type="text" id="artist" name="artist" required>
                </div>
                
                <div class="form-group">
                    <label for="musicComment">Comentario (opcional)</label>
                    <textarea id="musicComment" name="comment" rows="2"></textarea>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="submitMusicSuggestion()">Sugerir canción</button>
            </form>
        </div>
    </div>

    <!-- Dress Code Modal -->
    <div id="dressCode" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('dressCode')">&times;</span>
            <h3>Dress Code</h3>
            <div class="modal-text">
                <p>Para esta ocasión especial, sugerimos:</p>
                <p><strong>Caballeros:</strong> Traje formal o saco y corbata.</p>
                <p><strong>Damas:</strong> Vestido de cóctel o conjunto elegante.</p>
                <p>Los colores son libres, pero agradecemos evitar el blanco, reservado para la novia.</p>
            </div>
        </div>
    </div>

    <!-- Tips Modal -->
    <div id="tips" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('tips')">&times;</span>
            <h3>Tips y Notas</h3>
            <div class="modal-text">
                <ul>
                    <li>La ceremonia comenzará puntualmente a las 17:00hs. Te recomendamos llegar con 15 minutos de anticipación.</li>
                    <li>Habrá estacionamiento disponible en ambas locaciones.</li>
                    <li>Si necesitas alojamiento, tenemos convenios con hoteles cercanos. Consultanos para más información.</li>
                    <li>El servicio de transporte entre la ceremonia y la celebración estará disponible desde las 18:30hs.</li>
                    <li>Si tienes alguna restricción alimentaria, por favor háganoslo saber antes del 1 de Mayo.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Gifts Modal -->
    <div id="giftsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('giftsModal')">&times;</span>
            <h3>Regalos</h3>
            <div class="modal-text">
                <p>Contenido modal regalos</p>
                <div class="honeymoon-gift">
                    <h4>Luna de Miel</h4>
                    <p>También apreciaríamos enormemente cualquier contribución monetaria para nuestra luna de miel. Su apoyo nos ayudará a crear recuerdos inolvidables mientras comenzamos nuestra nueva vida juntos.</p>
                    <div class="bank-details">
                        <h5>SINPE MOVIL Bancarios:</h5>
                        <p>Banco: BAC San José</p>
                        <p>Titular: Danny y Sofía</p>
                        <p>Cuenta: XXXX-XXXX-XXXX-XXXX</p>
                        <p>Alias: BODA.DANNY.SOFIA</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Upload Instructions Modal -->
    <div id="photoUpload" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('photoUpload')">&times;</span>
            <h3>Cómo subir fotos a nuestro álbum</h3>
            <div class="modal-text">
                <ol>
                    <li>Escanea el código QR con la cámara de tu teléfono</li>
                    <li>Se abrirá un enlace a nuestro álbum compartido de Google Photos</li>
                    <li>Inicia sesión con tu cuenta de Google (si no lo has hecho ya)</li>
                    <li>Toca el botón "Añadir fotos" y selecciona las fotos que deseas compartir</li>
                    <li>¡Listo! Tus fotos se añadirán automáticamente a nuestro álbum</li>
                </ol>
                <p>¡Gracias por compartir estos momentos especiales con nosotros!</p>
            </div>
        </div>
    </div>

    <!-- Menu Modal -->
    <div id="menu" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('menu')">&times;</span>
            <h3>Menú de la Celebración</h3>
            <div class="modal-text">
                <h4>Recepción</h4>
                <p>Selección de bocadillos gourmet y champagne de bienvenida</p>
                
                <h4>Entrada</h4>
                <p>Tabla de quesos y fiambres selectos</p>
                
                <h4>Plato Principal (a elección)</h4>
                <ul>
                    <li>Salmón rosado con salsa de eneldo y puré de papas</li>
                    <li>Medallón de lomo con reducción de vino tinto y papas al romero</li>
                    <li>Opción vegetariana: Risotto de hongos silvestres</li>
                </ul>
                
                <h4>Postre</h4>
                <p>Crème brûlée con frutas del bosque</p>
                
                <h4>Bebidas</h4>
                <p>Vino tinto, vino blanco, cerveza, agua y refrescos</p>
                
                <h4>Mesa Dulce</h4>
                <p>Variedad de postres y mesa de café</p>
            </div>
        </div>
    </div>

    <!-- Kids Area Modal -->
    <div id="kidsArea" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('kidsArea')">&times;</span>
            <h3>Área para Niños</h3>
            <div class="modal-text">
                <p>Pensando en los más pequeños, hemos preparado:</p>
                <ul>
                    <li>Espacio dedicado con supervisión profesional</li>
                    <li>Actividades y juegos durante toda la celebración</li>
                    <li>Menú especial para niños</li>
                    <li>Zona de descanso para los más pequeños</li>
                </ul>
                <p>El servicio está disponible para niños de 3 a 12 años.</p>
            </div>
        </div>
    </div>

    <!-- Audio element for background music -->
    <audio id="bgMusic" loop>
        <source src="music/background-music.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Music control button - updated position -->
    <button id="musicToggle" class="music-toggle">
        <i class="fas fa-volume-up"></i>
    </button>
    
    <!-- Scripts -->
    <script>
        /**
         * API configuration
         */
        const API_CONFIG = {
            // Google Apps Script deployed as web app URL
            baseUrl: 'https://script.google.com/macros/s/AKfycbwQIe_-jNSjRJW3VEIwWlv9MdvcCifhR3kKRmv_ES4GX6vbNFWf3TutjjcqO-pLe-e3/exec',
            
            // Sheets IDs
            sheetsIds: {
                invitees: '1YOUR_INVITEES_SHEET_ID',
                confirmations: '1YOUR_CONFIRMATIONS_SHEET_ID',
                musicSuggestions: '1YOUR_MUSIC_SUGGESTIONS_SHEET_ID'
            }
        };

        /**
         * Helper function to load scripts via JSONP to bypass CORS restrictions
         * @param {string} url - The URL to fetch
         * @returns {Promise} - A promise that resolves with the data
         */
        function fetchJsonp(url) {
            return new Promise((resolve, reject) => {
                // Create a unique callback name
                const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
                
                // Create script element
                const script = document.createElement('script');
                
                // Setup the callback function
                window[callbackName] = function(data) {
                    // Clean up: remove script and delete callback
                    document.body.removeChild(script);
                    delete window[callbackName];
                    
                    // Resolve the promise with data
                    resolve(data);
                };
                
                // Add callback parameter to URL
                const jsonpUrl = url + (url.includes('?') ? '&' : '?') + 'callback=' + callbackName;
                
                // Setup script error handling
                script.onerror = function() {
                    // Clean up
                    document.body.removeChild(script);
                    delete window[callbackName];
                    
                    // Reject the promise
                    reject(new Error('JSONP request failed'));
                };
                
                // Set script attributes and append to DOM
                script.src = jsonpUrl;
                document.body.appendChild(script);
            });
        }

        /**
         * Get invitee data from Google Sheets
         * @param {string} inviteeId - The ID of the invitee
         * @returns {Promise<Object>} - The invitee data
         */
        async function getInviteeData(inviteeId) {
            try {
                const result = await fetchJsonp(`${API_CONFIG.baseUrl}?action=getInvitee&id=${inviteeId}`);
                
                if (result.status === 'success') {
                    return result.data;
                } else {
                    throw new Error(result.message || 'Failed to load invitee data');
                }
            } catch (error) {
                console.error('Error loading invitee data:', error);
                throw error;
            }
        }

        /**
         * Submit confirmation data to Google Sheets using an iframe for POST request
         * @param {Object} data - The confirmation data
         * @returns {Promise<Object>} - The response from the API
         */
        function submitConfirmationData(data) {
            return new Promise((resolve, reject) => {
                // Create a unique ID for the iframe
                const iframeId = 'iframe_submit_' + Math.round(100000 * Math.random());
                
                // Create an invisible iframe
                const iframe = document.createElement('iframe');
                iframe.setAttribute('id', iframeId);
                iframe.setAttribute('name', iframeId);
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                // Create a form to submit the data
                const form = document.createElement('form');
                form.setAttribute('method', 'post');
                form.setAttribute('action', API_CONFIG.baseUrl);
                form.setAttribute('target', iframeId);
                
                // Add action parameter
                const actionInput = document.createElement('input');
                actionInput.setAttribute('type', 'hidden');
                actionInput.setAttribute('name', 'action');
                actionInput.setAttribute('value', 'submitRSVP');
                form.appendChild(actionInput);
                
                // Add all data parameters
                Object.keys(data).forEach(key => {
                    const input = document.createElement('input');
                    input.setAttribute('type', 'hidden');
                    input.setAttribute('name', key);
                    input.setAttribute('value', data[key]);
                    form.appendChild(input);
                });
                
                // Append form to document
                document.body.appendChild(form);
                
                // Setup response handling
                iframe.onload = function() {
                    setTimeout(() => {
                        // Clean up
                        document.body.removeChild(iframe);
                        document.body.removeChild(form);
                        
                        // Resolve with success
                        resolve({ success: true });
                    }, 1000);
                };
                
                // Handle errors
                iframe.onerror = function() {
                    // Clean up
                    document.body.removeChild(iframe);
                    document.body.removeChild(form);
                    
                    reject(new Error('Failed to submit RSVP'));
                };
                
                // Submit the form
                form.submit();
            });
        }

        /**
         * Submit music suggestion to Google Sheets using an iframe
         * @param {Object} data - The music suggestion data
         * @returns {Promise<Object>} - The response from the API
         */
        function submitMusicSuggestionData(data) {
            return new Promise((resolve, reject) => {
                // Create a unique ID for the iframe
                const iframeId = 'iframe_music_' + Math.round(100000 * Math.random());
                
                // Create an invisible iframe
                const iframe = document.createElement('iframe');
                iframe.setAttribute('id', iframeId);
                iframe.setAttribute('name', iframeId);
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                // Create a form to submit the data
                const form = document.createElement('form');
                form.setAttribute('method', 'post');
                form.setAttribute('action', API_CONFIG.baseUrl);
                form.setAttribute('target', iframeId);
                
                // Add action parameter
                const actionInput = document.createElement('input');
                actionInput.setAttribute('type', 'hidden');
                actionInput.setAttribute('name', 'action');
                actionInput.setAttribute('value', 'submitMusicSuggestion');
                form.appendChild(actionInput);
                
                // Add all data parameters
                Object.keys(data).forEach(key => {
                    const input = document.createElement('input');
                    input.setAttribute('type', 'hidden');
                    input.setAttribute('name', key);
                    input.setAttribute('value', data[key]);
                    form.appendChild(input);
                });
                
                // Append form to document
                document.body.appendChild(form);
                
                // Setup response handling
                iframe.onload = function() {
                    setTimeout(() => {
                        // Clean up
                        document.body.removeChild(iframe);
                        document.body.removeChild(form);
                        
                        // Resolve with success
                        resolve({ success: true });
                    }, 1000);
                };
                
                // Handle errors
                iframe.onerror = function() {
                    // Clean up
                    document.body.removeChild(iframe);
                    document.body.removeChild(form);
                    
                    reject(new Error('Failed to submit music suggestion'));
                };
                
                // Submit the form
                form.submit();
            });
        }

        // Wedding date - Update this to your actual wedding date
        const weddingDate = new Date('2025-05-15T17:00:00');
        
        function updateCountdown() {
            const now = new Date();
            const diff = weddingDate - now;
            
            if (diff > 0) {
                const months = Math.floor(diff / (1000 * 60 * 60 * 24 * 30));
                const days = Math.floor((diff % (1000 * 60 * 60 * 24 * 30)) / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('months').textContent = String(months).padStart(2, '0');
                document.getElementById('days').textContent = String(days).padStart(2, '0');
                document.getElementById('hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
                
                // Hide months container if 0 months remaining
                const monthsContainer = document.getElementById('months-container');
                if (months === 0) {
                    monthsContainer.style.display = 'none';
                } else {
                    monthsContainer.style.display = 'block';
                }
            } else {
                // If wedding date has passed
                document.getElementById('countdown').style.display = 'none';
            }
        }

        // Initialize invitee data when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            // Get invitee ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const inviteeId = urlParams.get('id');
            
            if (inviteeId) {
                try {
                    // Load invitee data
                    const inviteeData = await getInviteeData(inviteeId);
                    
                    // Store invitee data for use in confirmation modals
                    window.inviteeData = inviteeData;
                    
                    console.log('Loaded invitee data:', inviteeData);
                    
                    // Get the max guests from the data (handle both maxGuests and maxguests properties)
                    const maxGuests = inviteeData.maxguests || inviteeData.maxGuests || 1;
                    
                    // Update confirmation modals with max guests
                    updateGuestCountOptions('ceremony', maxGuests);
                    updateGuestCountOptions('celebration', maxGuests);
                    
                    // Show guest count in confirmation text
                    document.getElementById('ceremonyGuestCount').textContent = maxGuests;
                    document.getElementById('celebrationGuestCount').textContent = maxGuests;
                    
                    // Set invitee IDs in forms
                    document.getElementById('ceremonyInviteeId').value = inviteeId;
                    document.getElementById('celebrationInviteeId').value = inviteeId;
                    document.getElementById('musicInviteeId').value = inviteeId;
                } catch (error) {
                    console.error('Error loading invitee data:', error);
                    // Handle error (e.g., show error message to user)
                    alert('Error loading invitation data. Please try again later.');
                }
            } else {
                console.warn('No invitee ID found in URL');
                // Hide RSVP buttons or show generic message
                document.querySelectorAll('.btn[onclick*="openModal(\'ceremonyConfirm\')"], .btn[onclick*="openModal(\'celebrationConfirm\')"]')
                    .forEach(btn => btn.style.display = 'none');
            }
            
            // Start countdown
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });

        /**
         * Update guest count options in confirmation modal
         * @param {string} eventType - 'ceremony' or 'celebration'
         * @param {number} maxGuests - Maximum number of guests allowed
         */
        function updateGuestCountOptions(eventType, maxGuests) {
            const select = document.getElementById(`${eventType}AttendingCount`);
            select.innerHTML = ''; // Clear existing options
            
            // Ensure maxGuests is a number and at least 1
            const max = Math.max(1, parseInt(maxGuests) || 1);
            
            // Add options from 1 to maxGuests
            for (let i = 1; i <= max; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                select.appendChild(option);
            }
        }

        /**
         * Handle attendance confirmation button click
         * @param {string} eventType - 'ceremony' or 'celebration'
         * @param {boolean} attending - Whether the invitee is attending
         */
        function confirmAttendance(eventType, attending) {
            const guestDetails = document.getElementById(`${eventType}GuestDetails`);
            if (attending) {
                guestDetails.style.display = 'block';
            } else {
                guestDetails.style.display = 'none';
                // Reset guest count
                document.getElementById(`${eventType}AttendingCount`).value = '1';
            }
        }

        /**
         * Submit confirmation for an event
         * @param {string} eventType - 'ceremony' or 'celebration'
         */
        async function submitConfirmation(eventType) {
            const form = document.getElementById(`${eventType}ConfirmForm`);
            const inviteeId = document.getElementById(`${eventType}InviteeId`).value;
            const attending = document.getElementById(`${eventType}GuestDetails`).style.display === 'block';
            const attendingCount = attending ? parseInt(document.getElementById(`${eventType}AttendingCount`).value) : 0;
            const comment = document.getElementById(`${eventType}Comment`).value;
            
            try {
                await submitConfirmationData({
                    inviteeId,
                    eventType,
                    attending,
                    attendingCount,
                    comment
                });
                
                // Close modal and show success message
                closeModal(`${eventType}Confirm`);
                alert('¡Gracias por confirmar tu asistencia!');
            } catch (error) {
                console.error('Error submitting confirmation:', error);
                alert('Hubo un error al confirmar tu asistencia. Por favor, intenta nuevamente.');
            }
        }

        /**
         * Submit a music suggestion
         */
        async function submitMusicSuggestion() {
            const form = document.getElementById('musicSuggestionForm');
            const inviteeId = document.getElementById('musicInviteeId').value;
            const songTitle = document.getElementById('songTitle').value;
            const artist = document.getElementById('artist').value;
            const comment = document.getElementById('musicComment').value;
            
            try {
                await submitMusicSuggestionData({
                    inviteeId,
                    songTitle,
                    artist,
                    comment
                });
                
                // Close modal and show success message
                closeModal('musicSuggestion');
                alert('¡Gracias por tu sugerencia musical!');
                
                // Reset form
                form.reset();
            } catch (error) {
                console.error('Error submitting music suggestion:', error);
                alert('Hubo un error al enviar tu sugerencia. Por favor, intenta nuevamente.');
            }
        }

        /**
         * Open a modal
         * @param {string} modalId - The ID of the modal to open
         */
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        /**
         * Close a modal
         * @param {string} modalId - The ID of the modal to close
         */
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        /**
         * Add event to calendar
         * @param {string} eventType - 'ceremony' or 'celebration'
         */
        function addToCalendar(eventType) {
            const eventDetails = {
                ceremony: {
                    title: 'Ceremonia de Boda - Danny & Sofía',
                    startTime: '2025-05-15T17:00:00',
                    endTime: '2025-05-15T18:30:00',
                    location: 'Parroquia Nuestra Señora de Lujan, Av. Pergamino 203, San José'
                },
                celebration: {
                    title: 'Celebración de Boda - Danny & Sofía',
                    startTime: '2025-05-15T20:00:00',
                    endTime: '2025-05-16T03:00:00',
                    location: 'Salon de fiestas Avril, Av. Los Reartes 12, San José'
                }
            };
            
            const event = eventDetails[eventType];
            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(event.title)}&dates=${event.startTime.replace(/[-:]/g, '')}/${event.endTime.replace(/[-:]/g, '')}&location=${encodeURIComponent(event.location)}`;
            
            window.open(googleCalendarUrl, '_blank');
        }

        /**
         * Open directions in maps app
         * @param {string} address - The destination address
         * @param {string} app - 'google' or 'waze'
         */
        function openDirections(address, app) {
            const encodedAddress = encodeURIComponent(address);
            
            if (app === 'google') {
                window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodedAddress}`, '_blank');
            } else if (app === 'waze') {
                window.open(`https://www.waze.com/ul?q=${encodedAddress}`, '_blank');
            }
        }
    </script>
</body>
</html> 